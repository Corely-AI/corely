model WebsiteSite {
  id            String   @id @default(cuid())
  tenantId      String
  name          String
  slug          String
  defaultLocale String
  brandingJson  Json?
  themeJson     Json?
  isDefault     Boolean  @default(false)
  createdAt     DateTime @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime @updatedAt @db.Timestamptz(6)

  domains   WebsiteDomain[]
  pages     WebsitePage[]
  menus     WebsiteMenu[]
  snapshots WebsitePageSnapshot[]
  feedbacks WebsiteFeedback[]
  qaItems   WebsiteQa[]
  wallOfLoveItems WebsiteWallOfLoveItem[]

  @@unique([tenantId, slug])
  @@index([tenantId])
  @@index([tenantId, isDefault])
  @@schema("content")
}

model WebsiteDomain {
  id        String   @id @default(cuid())
  tenantId  String
  siteId    String
  hostname  String
  isPrimary Boolean  @default(false)
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @db.Timestamptz(6)

  site WebsiteSite @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@unique([tenantId, hostname])
  @@index([tenantId])
  @@index([tenantId, siteId])
  @@schema("content")
}

model WebsitePage {
  id             String            @id @default(cuid())
  tenantId       String
  siteId         String
  path           String
  locale         String
  template       String
  status         WebsitePageStatus @default(DRAFT)
  cmsEntryId     String
  seoTitle       String?
  seoDescription String?
  seoImageFileId String?
  publishedAt    DateTime? @db.Timestamptz(6)
  createdAt      DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime  @updatedAt @db.Timestamptz(6)

  site      WebsiteSite           @relation(fields: [siteId], references: [id], onDelete: Cascade)
  snapshots WebsitePageSnapshot[]
  feedbacks WebsiteFeedback[]
  qaItems   WebsiteQa[]

  @@unique([tenantId, siteId, path, locale])
  @@index([tenantId])
  @@index([tenantId, siteId])
  @@index([tenantId, siteId, status])
  @@schema("content")
}

model WebsiteMenu {
  id        String   @id @default(cuid())
  tenantId  String
  siteId    String
  name      String
  locale    String
  itemsJson Json
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @db.Timestamptz(6)

  site WebsiteSite @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@unique([tenantId, siteId, name, locale])
  @@index([tenantId])
  @@index([tenantId, siteId])
  @@schema("content")
}

model WebsitePageSnapshot {
  id          String   @id @default(cuid())
  tenantId    String
  siteId      String
  pageId      String
  path        String
  locale      String
  version     Int
  payloadJson Json
  createdAt   DateTime @default(now()) @db.Timestamptz(6)

  page WebsitePage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  site WebsiteSite @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@unique([tenantId, pageId, version])
  @@index([tenantId])
  @@index([tenantId, siteId])
  @@index([pageId, version])
  @@schema("content")
}

model WebsiteFeedback {
  id         String   @id @default(cuid())
  tenantId   String
  siteId     String
  pageId     String?
  message    String
  email      String?
  name       String?
  rating     Int?
  youtubeJson Json
  metaJson   Json?
  createdAt  DateTime @default(now()) @db.Timestamptz(6)

  site   WebsiteSite            @relation(fields: [siteId], references: [id], onDelete: Cascade)
  page   WebsitePage?           @relation(fields: [pageId], references: [id], onDelete: SetNull)
  images WebsiteFeedbackImage[]

  @@index([tenantId, siteId, createdAt])
  @@index([tenantId, pageId, createdAt])
  @@schema("content")
}

model WebsiteFeedbackImage {
  id         String @id @default(cuid())
  tenantId   String
  feedbackId String
  fileId     String
  order      Int    @default(0)

  feedback WebsiteFeedback @relation(fields: [feedbackId], references: [id], onDelete: Cascade)

  @@index([tenantId, feedbackId])
  @@index([tenantId, fileId])
  @@schema("content")
}

model WebsiteQa {
  id         String          @id @default(cuid())
  tenantId   String
  siteId     String
  locale     String
  scope      WebsiteQaScope
  pageId     String?
  status     WebsiteQaStatus @default(DRAFT)
  order      Int             @default(0)
  question   String
  answerHtml String
  createdAt  DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime        @updatedAt @db.Timestamptz(6)

  site WebsiteSite  @relation(fields: [siteId], references: [id], onDelete: Cascade)
  page WebsitePage? @relation(fields: [pageId], references: [id], onDelete: SetNull)

  @@index([tenantId, siteId, locale, status, order])
  @@index([tenantId, siteId, pageId, locale, status, order])
  @@schema("content")
}

model WebsiteWallOfLoveItem {
  id          String                      @id @default(cuid())
  tenantId    String
  siteId      String
  type        WebsiteWallOfLoveItemType
  status      WebsiteWallOfLoveStatus     @default(DRAFT)
  order       Int
  quote       String?
  authorName  String?
  authorTitle String?
  sourceLabel String?
  linkUrl     String?
  createdAt   DateTime                    @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime                    @updatedAt @db.Timestamptz(6)

  site   WebsiteSite                  @relation(fields: [siteId], references: [id], onDelete: Cascade)
  images WebsiteWallOfLoveItemImage[]

  @@index([tenantId, siteId, status, order])
  @@index([tenantId, siteId, order])
  @@schema("content")
}

model WebsiteWallOfLoveItemImage {
  id       String @id @default(cuid())
  tenantId String
  itemId   String
  fileId   String
  order    Int    @default(0)

  item WebsiteWallOfLoveItem @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([tenantId, itemId, order])
  @@index([tenantId, fileId])
  @@schema("content")
}

enum WebsitePageStatus {
  DRAFT
  PUBLISHED
  @@schema("content")
}

enum WebsiteQaScope {
  SITE @map("site")
  PAGE @map("page")
  @@schema("content")
}

enum WebsiteQaStatus {
  DRAFT     @map("draft")
  PUBLISHED @map("published")
  @@schema("content")
}

enum WebsiteWallOfLoveItemType {
  IMAGE   @map("image")
  YOUTUBE @map("youtube")
  X       @map("x")
  @@schema("content")
}

enum WebsiteWallOfLoveStatus {
  DRAFT     @map("draft")
  PUBLISHED @map("published")
  @@schema("content")
}
