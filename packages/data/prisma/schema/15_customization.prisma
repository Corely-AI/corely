enum CustomFieldType {
  TEXT
  NUMBER
  DATE
  BOOLEAN
  SELECT
  MULTI_SELECT
  MONEY
  @@schema("platform")
}

model CustomFieldDefinition {
  id           String          @id @default(cuid())
  tenantId     String
  entityType   String
  key          String
  label        String
  description  String?
  type         CustomFieldType
  required     Boolean
  defaultValue Json?
  options      Json?
  validation   Json?
  isIndexed    Boolean         @default(false)
  isActive     Boolean         @default(true)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@unique([tenantId, entityType, key])
  @@index([tenantId, entityType])
  @@schema("platform")
}

model CustomFieldIndex {
  id         String   @id @default(cuid())
  tenantId   String
  entityType String
  entityId   String
  fieldId    String
  fieldKey   String
  valueText  String?
  valueNumber Float?
  valueDate  DateTime?
  valueBool  Boolean?
  valueJson  Json?
  updatedAt  DateTime @updatedAt

  @@unique([tenantId, entityType, entityId, fieldId])
  @@index([tenantId, entityType, fieldId])
  @@index([tenantId, entityType, fieldKey])
  @@index([tenantId, entityType, valueText])
  @@index([tenantId, entityType, valueNumber])
  @@index([tenantId, entityType, valueDate])
  @@index([tenantId, entityType, valueBool])
  @@schema("platform")
}

model EntityLayout {
  id         String   @id @default(cuid())
  tenantId   String
  entityType String
  layout     Json
  version    Int      @default(1)
  updatedAt  DateTime @updatedAt

  @@unique([tenantId, entityType])
  @@schema("platform")
}

model DimensionType {
  id            String   @id @default(cuid())
  tenantId      String
  code          String
  name          String
  description   String?
  appliesTo     String[]
  requiredFor   String[] @default([])
  allowMultiple Boolean  @default(false)
  isActive      Boolean  @default(true)
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  values      DimensionValue[]
  assignments EntityDimension[]

  @@unique([tenantId, code])
  @@index([tenantId, isActive, sortOrder])
  @@schema("platform")
}

model DimensionValue {
  id        String   @id @default(cuid())
  tenantId  String
  typeId    String
  code      String
  name      String
  isActive  Boolean  @default(true)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  type        DimensionType    @relation(fields: [typeId], references: [id], onDelete: Cascade)
  assignments EntityDimension[]

  @@unique([tenantId, typeId, code])
  @@index([tenantId, typeId, isActive, sortOrder])
  @@schema("platform")
}

model EntityDimension {
  id         String   @id @default(cuid())
  tenantId   String
  entityType String
  entityId   String
  typeId     String
  valueId    String
  createdAt  DateTime @default(now())

  type  DimensionType  @relation(fields: [typeId], references: [id], onDelete: Cascade)
  value DimensionValue @relation(fields: [valueId], references: [id], onDelete: Cascade)

  @@unique([tenantId, entityType, entityId, typeId, valueId])
  @@index([tenantId, entityType, entityId])
  @@index([tenantId, entityType, typeId, valueId])
  @@schema("platform")
}
