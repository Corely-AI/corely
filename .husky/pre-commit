# Skip hook if HUSKY is set to 0
if [ "$HUSKY" = "0" ]; then
  exit 0
fi

# Run lint-staged on staged files only.
# Disable task concurrency and increase heap size to prevent OOM on large merges.
NODE_OPTIONS="--max-old-space-size=12288" pnpm lint-staged --concurrent false

if [ $? -ne 0 ]; then
  echo "❌ lint-staged failed. Fix errors and try again."
  exit 1
fi

node scripts/check-staged-line-limit.mjs

if [ $? -ne 0 ]; then
  exit 1
fi

echo "✅ lint-staged passed."
